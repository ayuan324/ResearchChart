# 项目架构与目录说明

本项目采用 Next.js(App Router) + 静态 HTML 页面组合的方式部署在 Vercel。UI 由 public 下的静态 HTML 承载；服务端仅提供 API 路由。模型调用统一通过 OpenRouter 实现。

## 架构概览

- 前端展示：app_demo/public 下的 HTML 静态页（home/upload/analysis/result），浏览器侧管理本地状态（localStorage.paperData）
- 服务端 API：Next.js App Router 的 API Route（/api/ingest、/api/plan）
- 根路由：/ 重定向到 /home.html（轻量入口，无 React 页面）
- 部署目标：Vercel（Root Directory 指向 app_demo）

## 页面与路由

- /home.html：网站主页。按钮跳转 /upload.html
- /upload.html：用户上传页。调用 /api/ingest 成功后跳转 /analysis.html
- /analysis.html：分析页。默认展示表格 Tab；无数据则回到 /upload.html；“Generate Charts”跳转 /result.html
- /result.html：最终图表页。展示生成图片 + 原始表（后续可接入真实渲染）
- /：由 app_demo/app/page.tsx 重定向到 /home.html

## API 路由

- /api/ingest：接收 PDF，调用 LlamaParse 获取 Markdown + 表格，落地到 JSON；浏览器端持久化到 localStorage.paperData
- /api/plan：根据 Key Findings + 表格生成图表方案（OpenRouter 模型，预留对接）

## 数据流

1) 用户在 /upload.html 上传 PDF → POST /api/ingest
2) 服务端解析 → 返回 { summary/key_findings, tables, table_conclusions, markdown }
3) 前端保存到 localStorage.paperData
4) 跳转 /analysis.html 渲染“Key Findings/表格/结论/原文 MD”
5) 点击生成图按钮 → 跳转 /result.html（后续接入方案渲染与导出）

## 目录树（精简后）

```
app_demo/
  app/
    api/
      ingest/route.ts
      plan/route.ts
    layout.tsx
    page.tsx           # 仅负责将 / 重定向到 /home.html
  public/
    home.html
    upload.html
    analysis.html
    result.html
  next.config.mjs
  package.json
  tsconfig.json

```

## 环境变量

- OPENROUTER_API_KEY：OpenRouter API Key（所有模型统一通过 OpenRouter）
- LLAMAPARSE_API_KEY：LlamaParse Key（PDF→Markdown/表格）

在 Vercel 的项目 Settings → Environment Variables 中配置。开发本地可使用 .env.local（不要提交到仓库）。

## 开发与调试

- 开发
  - cd app_demo && npm install
  - npm run dev
  - 访问 http://localhost:3000/home.html
- 构建
  - npm run build
- 生产
  - 合并到 main 分支后，Vercel 自动构建与部署

## 规范与约定

- 代码风格：Google 代码风格
- 模型调用：统一 OpenRouter；避免直接对接厂商 SDK
- 文档位置：docs/
- 页面命名：统一 ASCII 路径（避免中文路径在构建/路由的兼容性问题）

## 后续规划（建议）

- 在 /result.html 接入基于 plan 的真实图渲染与导出
- 将 prompts 封装到 app_demo/lib/prompts.ts，openrouter 调用封装到 app_demo/lib/openrouter.ts
- 在 /api/plan 加入 JSON Schema 校验与重试策略
- 新增 docs/prompt-设计与数据约定.md 记录输入输出契约
